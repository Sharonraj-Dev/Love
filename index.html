<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>For My Dearest Sneha</title>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Playfair+Display:wght@400;700&family=Crimson+Text:ital@0;1&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Your existing CSS remains the same */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        :root {
            --primary-color: #ff6b6b;
            --secondary-color: #ff8e8e;
            --accent-color: #d46a6a;
            --text-color: #5a3e36;
            --light-bg: #fff9f9;
            --gradient: linear-gradient(135deg, #f9d1d1, #ffb6c1);
            --shadow-soft: 0 0 20px rgba(255, 107, 107, 0.3);
            --glow-primary: 0 0 10px rgba(255, 107, 107, 0.5);
        }
        body {
            font-family: 'Playfair Display', serif;
            background: var(--gradient);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow-x: hidden;
            color: var(--text-color);
            padding: 20px;
            animation: breath 8s ease-in-out infinite alternate;
        }
        @keyframes breath {
            0% { background: var(--gradient); }
            100% { background: linear-gradient(135deg, #f8d0d0, #ffa5b0); }
        }
        .container {
            position: relative;
            width: 100%;
            max-width: 1200px;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        /* Your existing CSS continues... */
        /* (Keep all your existing CSS styles as they are) */

        /* Enhanced Music Player Styles */
        .music-player {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 50px;
            padding: 12px 20px;
            display: flex;
            align-items: center;
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.15), var(--glow-primary);
            z-index: 5;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 107, 107, 0.3);
            transition: all 0.3s ease;
        }
        .music-player:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.2), var(--shadow-soft);
        }
        .music-btn {
            background: var(--primary-color);
            color: white;
            border: none;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            font-size: 18px;
        }
        .music-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.3s, height 0.3s;
        }
        .music-btn:hover::before {
            width: 70px;
            height: 70px;
        }
        .music-btn:hover {
            background: var(--accent-color);
            transform: scale(1.1);
        }
        .music-btn.playing {
            background: var(--accent-color);
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(212, 106, 106, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(212, 106, 106, 0); }
            100% { box-shadow: 0 0 0 0 rgba(212, 106, 106, 0); }
        }
        .music-text {
            margin-left: 12px;
            font-size: 14px;
            color: var(--text-color);
            font-style: italic;
            font-weight: 500;
            min-width: 80px;
        }
        .music-loading {
            opacity: 0.7;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="floating-hearts" id="hearts-container"></div>
        <div class="bg-decoration" id="bgDecoration"></div>
        <div class="confetti" id="confetti"></div>
       
        <div class="envelope-wrapper">
            <div class="envelope" id="envelope">
                <div class="letter" id="letter">
                    <h2>For My Sneha</h2>
                    <p>Click to open my heart...</p>
                </div>
                <div class="heart">❤️</div>
            </div>
        </div>
       
        <div class="full-letter" id="fullLetter">
            <button class="close-btn" id="closeBtn">×</button>
            <div class="letter-content">
                <div class="letter-header">
                    <h1>To My Dearest Sneha</h1>
                    <h2>A Letter From My Heart</h2>
                </div>
               
                <div class="letter-body">
                    <p>My Love,</p>
                   
                    <p>From the moment you entered my life, everything changed. The colors became brighter, the days became more meaningful, and my heart found its home in yours. Every day with you is a blessing I never knew I needed but now cannot imagine living without.</p>
                   
                    <p>Your smile lights up my world in ways that words could never fully capture. Your laughter is my favorite melody, and your presence brings a peace to my soul that I've never known before. In your eyes, I see my future, my happiness, and all the love I could ever hope for.</p>
                   
                    <div class="quote">
                        "In you, I've found the love of my life and my closest, truest friend. You are my today and all of my tomorrows."
                    </div>
                   
                    <p>I promise to cherish you, to support you in all your dreams, to be your shelter in storms, and your partner in laughter. I will love you not only for who you are but for who I am when I'm with you.</p>
                   
                    <p>You are the most beautiful person I know, inside and out, and I feel incredibly lucky to call you mine.</p>
                   
                    <p>With all my love, now and forever,</p>
                   
                    <div class="signature">
                        Yours always<br>
                        Sharon
                    </div>
                </div>
            </div>
        </div>
       
        <div class="music-player">
            <button class="music-btn" id="musicBtn">
                <i class="fas fa-music"></i>
            </button>
            <div class="music-text" id="musicText">Play Music</div>
        </div>
    </div>

    <!-- Audio Element with better configuration -->
    <audio id="backgroundMusic" loop preload="metadata">
        <source src="./song.mp3" type="audio/mpeg">
        <source src="./song.ogg" type="audio/ogg">
        Your browser does not support the audio element.
    </audio>

    <script>
        // DOM elements
        const envelope = document.getElementById('envelope');
        const letter = document.getElementById('letter');
        const fullLetter = document.getElementById('fullLetter');
        const closeBtn = document.getElementById('closeBtn');
        const musicBtn = document.getElementById('musicBtn');
        const musicText = document.getElementById('musicText');
        const backgroundMusic = document.getElementById('backgroundMusic');
        const confetti = document.getElementById('confetti');

        // Music state
        let isPlaying = false;
        let audioLoaded = false;

        // Enhanced music toggle function
        function toggleMusic() {
            if (!audioLoaded) {
                musicText.textContent = 'Loading...';
                musicBtn.classList.add('music-loading');
                
                // Load audio first
                backgroundMusic.load();
                return;
            }

            if (isPlaying) {
                backgroundMusic.pause();
                musicText.textContent = 'Play Music';
                musicBtn.innerHTML = '<i class="fas fa-music"></i>';
                musicBtn.classList.remove('playing');
            } else {
                const playPromise = backgroundMusic.play();
                
                if (playPromise !== undefined) {
                    playPromise.then(() => {
                        // Audio started successfully
                        musicText.textContent = 'Playing...';
                        musicBtn.innerHTML = '<i class="fas fa-pause"></i>';
                        musicBtn.classList.add('playing');
                        isPlaying = true;
                    }).catch(error => {
                        // Auto-play was prevented
                        console.error('Audio playback failed:', error);
                        musicText.textContent = 'Click to Play';
                        
                        if (error.name === 'NotAllowedError') {
                            alert('Please click the play button to start the music. Autoplay is blocked by your browser.');
                        }
                    });
                }
            }
            isPlaying = !isPlaying;
        }

        // Audio event listeners
        backgroundMusic.addEventListener('loadeddata', function() {
            console.log('Audio loaded successfully');
            audioLoaded = true;
            musicText.textContent = 'Play Music';
            musicBtn.classList.remove('music-loading');
        });

        backgroundMusic.addEventListener('canplaythrough', function() {
            console.log('Audio can play through');
            audioLoaded = true;
            musicText.textContent = 'Play Music';
            musicBtn.classList.remove('music-loading');
        });

        backgroundMusic.addEventListener('error', function(e) {
            console.error('Audio loading error:', e);
            musicText.textContent = 'Load Error';
            musicBtn.classList.add('music-loading');
            musicBtn.style.opacity = '0.5';
            musicBtn.style.cursor = 'not-allowed';
            
            // Show specific error message
            switch(backgroundMusic.error.code) {
                case backgroundMusic.error.MEDIA_ERR_ABORTED:
                    console.error('Audio loading was aborted');
                    break;
                case backgroundMusic.error.MEDIA_ERR_NETWORK:
                    console.error('Network error occurred while loading audio');
                    break;
                case backgroundMusic.error.MEDIA_ERR_DECODE:
                    console.error('Audio decoding error');
                    break;
                case backgroundMusic.error.MEDIA_ERR_SRC_NOT_SUPPORTED:
                    console.error('Audio format not supported');
                    break;
                default:
                    console.error('Unknown audio error occurred');
            }
        });

        backgroundMusic.addEventListener('ended', function() {
            // This shouldn't trigger due to loop, but just in case
            if (isPlaying) {
                backgroundMusic.currentTime = 0;
                backgroundMusic.play();
            }
        });

        // Event listeners
        musicBtn.addEventListener('click', toggleMusic);

        // Open the letter with animation and confetti
        envelope.addEventListener('click', function() {
            envelope.classList.add('open');
            letter.classList.add('open');
           
            createConfetti();
            setTimeout(() => {
                confetti.classList.add('active');
                setTimeout(() => {
                    confetti.classList.remove('active');
                }, 3000);
            }, 500);
           
            setTimeout(() => {
                fullLetter.classList.add('active');
            }, 800);
        });

        // Create confetti burst
        function createConfetti() {
            confetti.innerHTML = '';
            const colors = ['#ff6b6b', '#ff8e8e', '#d46a6a', '#ffb6c1'];
            const pieceCount = 50;
           
            for (let i = 0; i < pieceCount; i++) {
                const piece = document.createElement('div');
                piece.classList.add('confetti-piece');
                piece.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                piece.style.left = Math.random() * 100 + 'vw';
                piece.style.animationDelay = Math.random() * 0.5 + 's';
                piece.style.animationDuration = (2 + Math.random() * 2) + 's';
                confetti.appendChild(piece);
            }
        }

        // Close the letter
        closeBtn.addEventListener('click', function() {
            fullLetter.classList.remove('active');
            setTimeout(() => {
                envelope.classList.remove('open');
                letter.classList.remove('open');
            }, 500);
        });

        // Close the letter when clicking outside the content
        fullLetter.addEventListener('click', function(e) {
            if (e.target === this) {
                fullLetter.classList.remove('active');
                setTimeout(() => {
                    envelope.classList.remove('open');
                    letter.classList.remove('open');
                }, 500);
            }
        });

        // Create floating hearts
        function createHearts() {
            const heartsContainer = document.getElementById('hearts-container');
            const heartCount = 20;
           
            for (let i = 0; i < heartCount; i++) {
                const heart = document.createElement('div');
                heart.classList.add('floating-heart');
                heart.innerHTML = '❤️';
               
                const left = Math.random() * 100;
                const delay = Math.random() * 5;
                const duration = 6 + Math.random() * 4;
               
                heart.style.left = `${left}vw`;
                heart.style.animationDelay = `${delay}s`;
                heart.style.animationDuration = `${duration}s`;
               
                heartsContainer.appendChild(heart);
            }
        }

        // Create background decoration
        function createBgDecoration() {
            const bgDecoration = document.getElementById('bgDecoration');
            const heartCount = 8;
           
            for (let i = 0; i < heartCount; i++) {
                const heart = document.createElement('div');
                heart.classList.add('bg-heart');
                heart.innerHTML = '❤️';
               
                const top = Math.random() * 100;
                const left = Math.random() * 100;
                const delay = Math.random() * 20;
                const duration = 25 + Math.random() * 20;
               
                heart.style.top = `${top}vh`;
                heart.style.left = `${left}vw`;
                heart.style.animationDelay = `${delay}s`;
                heart.style.animationDuration = `${duration}s`;
               
                bgDecoration.appendChild(heart);
            }
        }

        // Initialize the page
        window.addEventListener('load', function() {
            createHearts();
            createBgDecoration();
           
            // Set audio volume
            backgroundMusic.volume = 0.7;
            
            // Fade in envelope
            envelope.style.opacity = '0';
            envelope.style.transform = 'scale(0.8)';
            setTimeout(() => {
                envelope.style.transition = 'all 1s ease';
                envelope.style.opacity = '1';
                envelope.style.transform = 'scale(1)';
            }, 500);

            // Try to preload audio
            setTimeout(() => {
                backgroundMusic.load();
            }, 1000);
        });

        // Add keyboard shortcut for music (Space bar)
        document.addEventListener('keydown', function(e) {
            if (e.code === 'Space' && !e.target.matches('input, textarea')) {
                e.preventDefault();
                toggleMusic();
            }
        });
    </script>
</body>
</html>
